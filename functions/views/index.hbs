<!DOCTYPE html>
<html lang="en">
  <body>
    <fieldset>
      <legend>Drone fly zone violations</legend>
         <ol id="pilotList"></ol>
    </fieldset>
  </body>
  <script>
    // page is fully loaded
    document.addEventListener('DOMContentLoaded', function () 
    { 
      const pilotList = document.getElementById("pilotList");
      const pilotListElements = pilotList.getElementsByTagName("li");
      var response;
      var update;
      var index;
      var listItem;

        // initial pilot list from database
      {{#each allPilots}}
        listItem = document.createElement("li");
        listItem.innerText = '{{this}}';
        pilotList.appendChild(listItem);
      {{/each}}

      // reguest data from server every 2 seconds
      setInterval( async function () 
      {
        // request data
        response = await fetch('/api', {
          method: 'GET'
        });
        update = await response.json();

        // remove old pilots from list
        update.removePilots.forEach((oldPilot) => {
          for (index = 0; index < pilotListElements.length; index++) {
            if ( oldPilot == pilotListElements.item(index).innerHTML) {
              pilotListElements.item(index).remove();
            }
          };
        });

        // add new pilots to list
        update.addPilots.forEach((newPilot) => {
          listItem = document.createElement("li");
          listItem.innerText = newPilot;
          pilotList.appendChild(listItem);
        });
      },5000);
  });
  </script>
</html>